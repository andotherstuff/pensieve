{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "title": "ðŸ“Š Pipeline Status",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Is the ingestion daemon running? Uses Prometheus 'up' metric which shows 0 when target is unreachable.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "0": { "color": "red", "index": 0, "text": "Down" } }, "type": "value" },
            { "options": { "1": { "color": "#73BF69", "index": 1, "text": "Up" } }, "type": "value" }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "#73BF69", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 0, "y": 1 },
      "id": 2,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "up{job=\"ingest\"}",
          "legendFormat": "Status",
          "refId": "A"
        }
      ],
      "title": "Ingestion",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Current live WebSocket connections to relays",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#FF7383", "value": null },
              { "color": "#FF9830", "value": 10 },
              { "color": "#73BF69", "value": 50 }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 3, "y": 1 },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "relay_connections_current",
          "legendFormat": "Connected",
          "refId": "A"
        }
      ],
      "title": "Relays Connected",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Is negentropy sync currently in progress?",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "0": { "color": "text", "index": 0, "text": "Idle" } }, "type": "value" },
            { "options": { "1": { "color": "#73BF69", "index": 1, "text": "Syncing" } }, "type": "value" }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "text", "value": null },
              { "color": "#73BF69", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 6, "y": 1 },
      "id": 4,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_sync_in_progress",
          "legendFormat": "Status",
          "refId": "A"
        }
      ],
      "title": "Negentropy",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Events per second from all sources (5s average)",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#3274D9", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 9, "y": 1 },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "ingest_events_received_rate",
          "legendFormat": "Rate",
          "refId": "A"
        }
      ],
      "title": "Events/sec",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Total novel events written from relays",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 12, "y": 1 },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "relay_events_written_total",
          "legendFormat": "Written",
          "refId": "A"
        }
      ],
      "title": "Relay Written",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Total novel events written from negentropy",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#8F3BB8", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 15, "y": 1 },
      "id": 7,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_events_written_total",
          "legendFormat": "Written",
          "refId": "A"
        }
      ],
      "title": "Negentropy Written",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Percentage of incoming events that are duplicates",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "max": 1,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null },
              { "color": "#FF9830", "value": 0.7 },
              { "color": "#FF7383", "value": 0.9 }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 18, "y": 1 },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "ingest_dedupe_ratio",
          "legendFormat": "Ratio",
          "refId": "A"
        }
      ],
      "title": "Dedupe %",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
      "description": "Total events in ClickHouse",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "#3274D9", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 3, "w": 3, "x": 21, "y": 1 },
      "id": 9,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
          "queryType": "sql",
          "rawSql": "SELECT sumMerge(total_events_state) as total FROM daily_active_users_summary",
          "refId": "A",
          "format": 1
        }
      ],
      "title": "Total Events",
      "type": "stat"
    },

    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Events received, written (novel), and deduplicated - from all sources",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "events/sec",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Total Received" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#3274D9", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Novel (Written)" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#73BF69", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Duplicates" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#FF9830", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 },
      "id": 10,
      "options": {
        "legend": { "calcs": ["mean", "sum"], "displayMode": "table", "placement": "bottom", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "rate(ingest_events_received_total[1m])",
          "legendFormat": "Total Received",
          "refId": "A"
        },
        {
          "expr": "rate(ingest_events_processed_total[1m])",
          "legendFormat": "Novel (Written)",
          "refId": "B"
        },
        {
          "expr": "rate(ingest_events_deduplicated_total[1m])",
          "legendFormat": "Duplicates",
          "refId": "C"
        }
      ],
      "title": "Pipeline Throughput (events/sec)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Breakdown by source: relays vs negentropy",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "events/sec",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Relay Written" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#73BF69", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Relay Deduped" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#b7dbab", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "dash": [5, 5], "fill": "dash" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Negentropy Written" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#8F3BB8", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Negentropy Deduped" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#d5a6e6", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "dash": [5, 5], "fill": "dash" } }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 },
      "id": 11,
      "options": {
        "legend": { "calcs": ["mean", "sum"], "displayMode": "table", "placement": "bottom", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "rate(relay_events_written_total[1m])",
          "legendFormat": "Relay Written",
          "refId": "A"
        },
        {
          "expr": "rate(relay_events_deduplicated_total[1m])",
          "legendFormat": "Relay Deduped",
          "refId": "B"
        },
        {
          "expr": "rate(negentropy_events_written_total[1m])",
          "legendFormat": "Negentropy Written",
          "refId": "C"
        },
        {
          "expr": "rate(negentropy_events_deduplicated_total[1m])",
          "legendFormat": "Negentropy Deduped",
          "refId": "D"
        }
      ],
      "title": "Throughput by Source (events/sec)",
      "type": "timeseries"
    },

    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 12 },
      "id": 100,
      "title": "ðŸ“¡ Relay Connections",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "WebSocket connections over time",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Connected" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#73BF69", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Known (DB)" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#3274D9", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Blocked" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#FF7383", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 13 },
      "id": 101,
      "options": {
        "legend": { "calcs": ["last"], "displayMode": "table", "placement": "right", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "relay_connections_current",
          "legendFormat": "Connected",
          "refId": "A"
        },
        {
          "expr": "relay_manager_total_relays",
          "legendFormat": "Known (DB)",
          "refId": "B"
        },
        {
          "expr": "relay_manager_blocked_relays",
          "legendFormat": "Blocked",
          "refId": "C"
        }
      ],
      "title": "Relay Connections Over Time",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Connection and disconnection activity",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "hue",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": "Connect.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#73BF69", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byRegexp", "options": "Disconnect.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#FF7383", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Failures" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#FF9830", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 13 },
      "id": 102,
      "options": {
        "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "right", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "increase(relay_connects_total[5m])",
          "legendFormat": "Connect ({{reason}})",
          "refId": "A"
        },
        {
          "expr": "increase(relay_disconnects_total[5m])",
          "legendFormat": "Disconnect ({{reason}})",
          "refId": "B"
        },
        {
          "expr": "increase(relay_connect_failures_total[5m])",
          "legendFormat": "Failures",
          "refId": "C"
        }
      ],
      "title": "Connection Activity (5m)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "frser-sqlite-datasource", "uid": "sqlite-relays" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": {
            "align": "auto",
            "cellOptions": { "type": "auto" },
            "inspect": false,
            "filterable": true
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "url" },
            "properties": [{ "id": "custom.width", "value": 300 }]
          },
          {
            "matcher": { "id": "byName", "options": "score" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "decimals", "value": 2 },
              { "id": "custom.cellOptions", "value": { "mode": "gradient", "type": "gauge", "valueDisplayMode": "text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "novel_rate_1h" },
            "properties": [
              { "id": "custom.width", "value": 100 },
              { "id": "decimals", "value": 1 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "uptime_24h" },
            "properties": [
              { "id": "custom.width", "value": 90 },
              { "id": "unit", "value": "percentunit" },
              { "id": "decimals", "value": 0 }
            ]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 19 },
      "id": 103,
      "options": {
        "cellHeight": "sm",
        "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "score" }]
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "datasource": { "type": "frser-sqlite-datasource", "uid": "sqlite-relays" },
          "queryType": "table",
          "rawQueryText": "SELECT r.url, s.score, s.novel_rate_1h, s.uptime_24h FROM relays r LEFT JOIN relay_scores s ON r.url = s.relay_url WHERE r.status = 'active' ORDER BY s.score DESC LIMIT 50",
          "refId": "A"
        }
      ],
      "title": "Top Connected Relays (by score)",
      "type": "table"
    },
    {
      "datasource": { "type": "frser-sqlite-datasource", "uid": "sqlite-relays" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": {
            "align": "auto",
            "cellOptions": { "type": "auto" },
            "inspect": false,
            "filterable": true
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "url" },
            "properties": [{ "id": "custom.width", "value": 300 }]
          },
          {
            "matcher": { "id": "byName", "options": "status" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "mappings", "value": [
                { "options": { "failing": { "color": "orange", "index": 0 } }, "type": "value" },
                { "options": { "blocked": { "color": "red", "index": 1 } }, "type": "value" }
              ]}
            ]
          },
          {
            "matcher": { "id": "byName", "options": "failures" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "thresholds", "value": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 3 }, { "color": "red", "value": 5 }] } },
              { "id": "custom.cellOptions", "value": { "mode": "basic", "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "blocked_reason" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 19 },
      "id": 104,
      "options": {
        "cellHeight": "sm",
        "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "failures" }]
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "datasource": { "type": "frser-sqlite-datasource", "uid": "sqlite-relays" },
          "queryType": "table",
          "rawQueryText": "SELECT url, status, consecutive_failures as failures, blocked_reason FROM relays WHERE status IN ('failing', 'blocked') OR consecutive_failures > 0 ORDER BY consecutive_failures DESC LIMIT 50",
          "refId": "A"
        }
      ],
      "title": "Failing & Blocked Relays",
      "type": "table"
    },

    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
      "id": 200,
      "title": "ðŸ”„ Negentropy Sync",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Time since the last sync completed",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null },
              { "color": "#FF9830", "value": 1800 },
              { "color": "#FF7383", "value": 3600 }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 0, "y": 28 },
      "id": 201,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "time() - negentropy_last_sync_unix",
          "legendFormat": "Ago",
          "refId": "A"
        }
      ],
      "title": "Last Sync Ago",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#3274D9", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 3, "y": 28 },
      "id": 202,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_syncs_total",
          "legendFormat": "Syncs",
          "refId": "A"
        }
      ],
      "title": "Total Syncs",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Events currently being received during active sync",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#8F3BB8", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 6, "y": 28 },
      "id": 203,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_events_receiving",
          "legendFormat": "Receiving",
          "refId": "A"
        }
      ],
      "title": "Receiving Now",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Sync state database size",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#8F3BB8", "value": null }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 9, "y": 28 },
      "id": 204,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_sync_state_items",
          "legendFormat": "Items",
          "refId": "A"
        }
      ],
      "title": "Sync State",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Rate of events from negentropy sync",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "events/sec",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Written" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#8F3BB8", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Deduped" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#d5a6e6", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 28 },
      "id": 205,
      "options": {
        "legend": { "calcs": ["mean", "sum"], "displayMode": "table", "placement": "bottom", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "rate(negentropy_events_written_total[1m])",
          "legendFormat": "Written",
          "refId": "A"
        },
        {
          "expr": "rate(negentropy_events_deduplicated_total[1m])",
          "legendFormat": "Deduped",
          "refId": "B"
        }
      ],
      "title": "Negentropy Event Rate",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "description": "Cumulative events and sync state",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "opacity",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Written" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#8F3BB8", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "Sync State" },
            "properties": [{ "id": "color", "value": { "fixedColor": "#3274D9", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 32 },
      "id": 206,
      "options": {
        "legend": { "calcs": ["last"], "displayMode": "table", "placement": "right", "showLegend": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "pluginVersion": "11.0.0",
      "targets": [
        {
          "expr": "negentropy_events_written_total",
          "legendFormat": "Written",
          "refId": "A"
        },
        {
          "expr": "negentropy_sync_state_items",
          "legendFormat": "Sync State",
          "refId": "B"
        }
      ],
      "title": "Negentropy Cumulative",
      "type": "timeseries"
    },

    {
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 36 },
      "id": 300,
      "title": "ðŸ—„ï¸ ClickHouse Data",
      "type": "row",
      "collapsed": true,
      "panels": [
        {
          "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "#37872D", "value": null }] },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": { "h": 5, "w": 6, "x": 0, "y": 37 },
          "id": 301,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "textMode": "auto"
          },
          "pluginVersion": "11.0.0",
          "targets": [
            {
              "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
              "queryType": "sql",
              "rawSql": "SELECT sumMerge(total_events_state) as new_events FROM daily_active_users_summary WHERE date >= today() - 1",
              "refId": "A",
              "format": 1
            }
          ],
          "title": "New Events (24h)",
          "type": "stat"
        },
        {
          "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "#8F3BB8", "value": null }] },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": { "h": 5, "w": 6, "x": 6, "y": 37 },
          "id": 302,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "textMode": "auto"
          },
          "pluginVersion": "11.0.0",
          "targets": [
            {
              "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
              "queryType": "sql",
              "rawSql": "SELECT uniq(pubkey) as unique_authors FROM events_local",
              "refId": "A",
              "format": 1
            }
          ],
          "title": "Unique Authors",
          "type": "stat"
        },
        {
          "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "#3274D9", "value": null }] },
              "unit": "decbytes"
            },
            "overrides": []
          },
          "gridPos": { "h": 5, "w": 6, "x": 12, "y": 37 },
          "id": 303,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "textMode": "auto"
          },
          "pluginVersion": "11.0.0",
          "targets": [
            {
              "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
              "queryType": "sql",
              "rawSql": "SELECT sum(data_compressed_bytes) as compressed_size FROM system.parts WHERE database = 'nostr' AND active = 1",
              "refId": "A",
              "format": 1
            }
          ],
          "title": "Storage (Compressed)",
          "type": "stat"
        },
        {
          "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "thresholds" },
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "#73BF69", "value": null }] },
              "unit": "dateTimeAsIso"
            },
            "overrides": []
          },
          "gridPos": { "h": 5, "w": 6, "x": 18, "y": 37 },
          "id": 304,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "textMode": "auto"
          },
          "pluginVersion": "11.0.0",
          "targets": [
            {
              "datasource": { "type": "grafana-clickhouse-datasource", "uid": "clickhouse-nostr" },
              "queryType": "sql",
              "rawSql": "SELECT toUnixTimestamp(max(created_at)) * 1000 as newest FROM events_local WHERE created_at <= now()",
              "refId": "A",
              "format": 0
            }
          ],
          "title": "Newest Event",
          "type": "stat"
        },
      ]
    }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "tags": ["pensieve", "nostr", "ingestion"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "utc",
  "title": "Pensieve Ingestion",
  "uid": "pensieve-ingestion",
  "version": 3,
  "weekStart": ""
}
