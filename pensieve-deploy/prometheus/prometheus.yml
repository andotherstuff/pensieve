# Prometheus configuration for Pensieve Production
#
# Scrapes metrics from:
# - Prometheus itself
# - ClickHouse (built-in metrics)
# - Pensieve ingester (native binary on host, port 9091)
# - Pensieve backfill (native binary on host, port 9092)

global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # ═══════════════════════════════════════════════════════════════════════════
  # Prometheus self-monitoring
  # ═══════════════════════════════════════════════════════════════════════════
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ═══════════════════════════════════════════════════════════════════════════
  # ClickHouse metrics
  # ═══════════════════════════════════════════════════════════════════════════
  - job_name: 'clickhouse'
    static_configs:
      - targets: ['clickhouse:8123']
    metrics_path: '/metrics'

  # ═══════════════════════════════════════════════════════════════════════════
  # Pensieve Ingester (native binary on host via systemd)
  # Metrics exposed on port 9091
  # ═══════════════════════════════════════════════════════════════════════════
  - job_name: 'ingest'
    static_configs:
      # host.docker.internal reaches the host from inside Docker (Linux needs extra_hosts)
      - targets: ['host.docker.internal:9091']

  # ═══════════════════════════════════════════════════════════════════════════
  # Pensieve Backfill (native binary on host, when running)
  # Metrics exposed on port 9092
  # ═══════════════════════════════════════════════════════════════════════════
  - job_name: 'backfill'
    static_configs:
      - targets: ['host.docker.internal:9092']
